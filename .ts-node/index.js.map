{"version":3,"file":"index.js","sourceRoot":"","sources":["../olap/index.ts"],"names":[],"mappings":"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","sourcesContent":["import ____moose____typia from \"typia\";\nimport { OlapTable, getMooseClients, sql, ClickHouseEngines, MaterializedView } from '@514labs/moose-lib';\nexport interface EventModel {\n    transaction_id: string;\n    event_type: string;\n    product_id: number;\n    customer_id: string;\n    amount: number;\n    quantity: number;\n    event_time: Date;\n    // Denormalized fields for simpler analytics queries without joins in this demo\n    customer_email: string;\n    customer_name: string;\n    product_name: string;\n    status: string; // e.g. 'completed', 'active', 'inactive'\n}\n// Workaround for Next.js runtime where ts-patch/compiler plugin is missing\nexport const Events = new OlapTable<EventModel>('events', {\n    orderByFields: ['event_time']\n}, ____moose____typia.json.schemas<[\n    import(\"@514labs/moose-lib\").StripDateIntersection<EventModel>\n]>(), JSON.parse(\"[{\\\"name\\\":\\\"transaction_id\\\",\\\"data_type\\\":\\\"String\\\",\\\"primary_key\\\":false,\\\"required\\\":true,\\\"unique\\\":false,\\\"default\\\":null,\\\"ttl\\\":null,\\\"annotations\\\":[]},{\\\"name\\\":\\\"event_type\\\",\\\"data_type\\\":\\\"String\\\",\\\"primary_key\\\":false,\\\"required\\\":true,\\\"unique\\\":false,\\\"default\\\":null,\\\"ttl\\\":null,\\\"annotations\\\":[]},{\\\"name\\\":\\\"product_id\\\",\\\"data_type\\\":\\\"Float64\\\",\\\"primary_key\\\":false,\\\"required\\\":true,\\\"unique\\\":false,\\\"default\\\":null,\\\"ttl\\\":null,\\\"annotations\\\":[]},{\\\"name\\\":\\\"customer_id\\\",\\\"data_type\\\":\\\"String\\\",\\\"primary_key\\\":false,\\\"required\\\":true,\\\"unique\\\":false,\\\"default\\\":null,\\\"ttl\\\":null,\\\"annotations\\\":[]},{\\\"name\\\":\\\"amount\\\",\\\"data_type\\\":\\\"Float64\\\",\\\"primary_key\\\":false,\\\"required\\\":true,\\\"unique\\\":false,\\\"default\\\":null,\\\"ttl\\\":null,\\\"annotations\\\":[]},{\\\"name\\\":\\\"quantity\\\",\\\"data_type\\\":\\\"Float64\\\",\\\"primary_key\\\":false,\\\"required\\\":true,\\\"unique\\\":false,\\\"default\\\":null,\\\"ttl\\\":null,\\\"annotations\\\":[]},{\\\"name\\\":\\\"event_time\\\",\\\"data_type\\\":\\\"DateTime\\\",\\\"primary_key\\\":false,\\\"required\\\":true,\\\"unique\\\":false,\\\"default\\\":null,\\\"ttl\\\":null,\\\"annotations\\\":[]},{\\\"name\\\":\\\"customer_email\\\",\\\"data_type\\\":\\\"String\\\",\\\"primary_key\\\":false,\\\"required\\\":true,\\\"unique\\\":false,\\\"default\\\":null,\\\"ttl\\\":null,\\\"annotations\\\":[]},{\\\"name\\\":\\\"customer_name\\\",\\\"data_type\\\":\\\"String\\\",\\\"primary_key\\\":false,\\\"required\\\":true,\\\"unique\\\":false,\\\"default\\\":null,\\\"ttl\\\":null,\\\"annotations\\\":[]},{\\\"name\\\":\\\"product_name\\\",\\\"data_type\\\":\\\"String\\\",\\\"primary_key\\\":false,\\\"required\\\":true,\\\"unique\\\":false,\\\"default\\\":null,\\\"ttl\\\":null,\\\"annotations\\\":[]},{\\\"name\\\":\\\"status\\\",\\\"data_type\\\":\\\"String\\\",\\\"primary_key\\\":false,\\\"required\\\":true,\\\"unique\\\":false,\\\"default\\\":null,\\\"ttl\\\":null,\\\"annotations\\\":[]}]\") as any, {\n    validate: (data: unknown) => {\n        const result = ____moose____typia.createValidate<import(\"@514labs/moose-lib\").StripDateIntersection<EventModel>>()(data);\n        return {\n            success: result.success,\n            data: result.success ? result.data : undefined,\n            errors: result.success ? undefined : result.errors\n        };\n    },\n    assert: ____moose____typia.createAssert<import(\"@514labs/moose-lib\").StripDateIntersection<EventModel>>(),\n    is: ____moose____typia.createIs<import(\"@514labs/moose-lib\").StripDateIntersection<EventModel>>()\n});\nexport interface OverviewMetricsModel {\n    revenue: number;\n    sales_count: number;\n    customers_count: number;\n    products_sold: number;\n    event_time: Date;\n}\nexport const OverviewMetrics = new OlapTable<OverviewMetricsModel>('overview_metrics', {\n    orderByFields: ['event_time'],\n    engine: ClickHouseEngines.SummingMergeTree\n}, ____moose____typia.json.schemas<[\n    import(\"@514labs/moose-lib\").StripDateIntersection<OverviewMetricsModel>\n]>(), JSON.parse(\"[{\\\"name\\\":\\\"revenue\\\",\\\"data_type\\\":\\\"Float64\\\",\\\"primary_key\\\":false,\\\"required\\\":true,\\\"unique\\\":false,\\\"default\\\":null,\\\"ttl\\\":null,\\\"annotations\\\":[]},{\\\"name\\\":\\\"sales_count\\\",\\\"data_type\\\":\\\"Float64\\\",\\\"primary_key\\\":false,\\\"required\\\":true,\\\"unique\\\":false,\\\"default\\\":null,\\\"ttl\\\":null,\\\"annotations\\\":[]},{\\\"name\\\":\\\"customers_count\\\",\\\"data_type\\\":\\\"Float64\\\",\\\"primary_key\\\":false,\\\"required\\\":true,\\\"unique\\\":false,\\\"default\\\":null,\\\"ttl\\\":null,\\\"annotations\\\":[]},{\\\"name\\\":\\\"products_sold\\\",\\\"data_type\\\":\\\"Float64\\\",\\\"primary_key\\\":false,\\\"required\\\":true,\\\"unique\\\":false,\\\"default\\\":null,\\\"ttl\\\":null,\\\"annotations\\\":[]},{\\\"name\\\":\\\"event_time\\\",\\\"data_type\\\":\\\"DateTime\\\",\\\"primary_key\\\":false,\\\"required\\\":true,\\\"unique\\\":false,\\\"default\\\":null,\\\"ttl\\\":null,\\\"annotations\\\":[]}]\") as any, {\n    validate: (data: unknown) => {\n        const result = ____moose____typia.createValidate<import(\"@514labs/moose-lib\").StripDateIntersection<OverviewMetricsModel>>()(data);\n        return {\n            success: result.success,\n            data: result.success ? result.data : undefined,\n            errors: result.success ? undefined : result.errors\n        };\n    },\n    assert: ____moose____typia.createAssert<import(\"@514labs/moose-lib\").StripDateIntersection<OverviewMetricsModel>>(),\n    is: ____moose____typia.createIs<import(\"@514labs/moose-lib\").StripDateIntersection<OverviewMetricsModel>>()\n});\nexport const OverViewMV = new MaterializedView<OverviewMetricsModel>({\n    selectTables: [Events],\n    targetTable: OverviewMetrics,\n    selectStatement: sql `SELECT sum(amount) as revenue, count(*) as sales_count, uniq(customer_id) as customers_count, uniq(product_id) as products_sold, event_time FROM ${Events} WHERE event_type = 'purchase' GROUP BY event_time`,\n    materializedViewName: 'overview_mv'\n}, ____moose____typia.json.schemas<[\n    import(\"@514labs/moose-lib\").StripDateIntersection<OverviewMetricsModel>\n]>(), JSON.parse(\"[{\\\"name\\\":\\\"revenue\\\",\\\"data_type\\\":\\\"Float64\\\",\\\"primary_key\\\":false,\\\"required\\\":true,\\\"unique\\\":false,\\\"default\\\":null,\\\"ttl\\\":null,\\\"annotations\\\":[]},{\\\"name\\\":\\\"sales_count\\\",\\\"data_type\\\":\\\"Float64\\\",\\\"primary_key\\\":false,\\\"required\\\":true,\\\"unique\\\":false,\\\"default\\\":null,\\\"ttl\\\":null,\\\"annotations\\\":[]},{\\\"name\\\":\\\"customers_count\\\",\\\"data_type\\\":\\\"Float64\\\",\\\"primary_key\\\":false,\\\"required\\\":true,\\\"unique\\\":false,\\\"default\\\":null,\\\"ttl\\\":null,\\\"annotations\\\":[]},{\\\"name\\\":\\\"products_sold\\\",\\\"data_type\\\":\\\"Float64\\\",\\\"primary_key\\\":false,\\\"required\\\":true,\\\"unique\\\":false,\\\"default\\\":null,\\\"ttl\\\":null,\\\"annotations\\\":[]},{\\\"name\\\":\\\"event_time\\\",\\\"data_type\\\":\\\"DateTime\\\",\\\"primary_key\\\":false,\\\"required\\\":true,\\\"unique\\\":false,\\\"default\\\":null,\\\"ttl\\\":null,\\\"annotations\\\":[]}]\") as any);\nconst globalForMoose = globalThis as unknown as {\n    mooseClient: Awaited<ReturnType<typeof getMooseClients>> | undefined;\n};\nexport const getMoose = async () => {\n    if (globalForMoose.mooseClient)\n        return globalForMoose.mooseClient;\n    // Create client with shorter timeout for demo if possible, or handle connection error later\n    try {\n        const client = await getMooseClients({\n            database: 'local',\n            host: 'localhost',\n            port: '18123',\n            username: 'panda',\n            password: 'pandapass',\n            useSSL: false\n        });\n        if (process.env.NODE_ENV !== 'production') {\n            globalForMoose.mooseClient = client;\n        }\n        return client;\n    }\n    catch (error) {\n        console.warn('Failed to connect to Moose/ClickHouse, using mock mode:', error);\n        return null;\n    }\n};\n// Mock Data for Fallback\nconst MOCK_REVENUE = [{ total_revenue: 45231.89 }];\nconst MOCK_SALES = [{ total_sales: 2350 }];\nconst MOCK_ACTIVE = [{ active_users: 573 }];\nconst MOCK_REVENUE_OVER_TIME = [\n    { month: '2024-01-01', revenue: 3500 },\n    { month: '2024-02-01', revenue: 4500 },\n    { month: '2024-03-01', revenue: 3000 },\n    { month: '2024-04-01', revenue: 6000 },\n    { month: '2024-05-01', revenue: 4000 },\n    { month: '2024-06-01', revenue: 7500 },\n    { month: '2024-07-01', revenue: 5500 },\n    { month: '2024-08-01', revenue: 6500 },\n    { month: '2024-09-01', revenue: 5000 },\n    { month: '2024-10-01', revenue: 8000 },\n    { month: '2024-11-01', revenue: 6000 },\n    { month: '2024-12-01', revenue: 9000 }\n];\nconst MOCK_RECENT_SALES: EventModel[] = [\n    {\n        customer_name: 'Olivia Martin',\n        customer_email: 'olivia.martin@email.com',\n        amount: 1999.0,\n        event_time: new Date(),\n        transaction_id: '1',\n        event_type: 'purchase',\n        product_id: 1,\n        customer_id: 'c1',\n        quantity: 1,\n        product_name: 'Laser Lemonade Machine',\n        status: 'completed'\n    },\n    {\n        customer_name: 'Jackson Lee',\n        customer_email: 'jackson.lee@email.com',\n        amount: 39.0,\n        event_time: new Date(),\n        transaction_id: '2',\n        event_type: 'purchase',\n        product_id: 2,\n        customer_id: 'c2',\n        quantity: 1,\n        product_name: 'AeroGlow Desk Lamp',\n        status: 'completed'\n    },\n    {\n        customer_name: 'Isabella Nguyen',\n        customer_email: 'isabella.nguyen@email.com',\n        amount: 299.0,\n        event_time: new Date(),\n        transaction_id: '3',\n        event_type: 'purchase',\n        product_id: 3,\n        customer_id: 'c3',\n        quantity: 1,\n        product_name: 'Hypernova Headphones',\n        status: 'completed'\n    },\n    {\n        customer_name: 'William Kim',\n        customer_email: 'will@email.com',\n        amount: 99.0,\n        event_time: new Date(),\n        transaction_id: '4',\n        event_type: 'purchase',\n        product_id: 4,\n        customer_id: 'c4',\n        quantity: 1,\n        product_name: 'Terraform T-Shirt',\n        status: 'completed'\n    }\n];\nconst MOCK_TOP_PRODUCTS = [\n    {\n        product_name: 'Laser Lemonade Machine',\n        total_sales: 1234,\n        total_revenue: 616987.66,\n        status: 'Active'\n    },\n    {\n        product_name: 'Hypernova Headphones',\n        total_sales: 843,\n        total_revenue: 109581.57,\n        status: 'Active'\n    },\n    {\n        product_name: 'AeroGlow Desk Lamp',\n        total_sales: 421,\n        total_revenue: 16835.79,\n        status: 'Out of Stock'\n    }\n];\nconst MOCK_CUSTOMER_STATS_TOTAL = [{ total_customers: 2350 }];\nconst MOCK_RECENT_CUSTOMERS = [\n    {\n        customer_name: 'Liam Johnson',\n        customer_email: 'liam@example.com',\n        spent: 250.0,\n        status: 'Active'\n    },\n    {\n        customer_name: 'Emma Wilson',\n        customer_email: 'emma@example.com',\n        spent: 150.0,\n        status: 'Active'\n    },\n    {\n        customer_name: 'Noah Brown',\n        customer_email: 'noah@example.com',\n        spent: 0.0,\n        status: 'Inactive'\n    }\n];\nasync function executeQuery<T>(query: any, fallback: T): Promise<T> {\n    const moose = await getMoose();\n    if (!moose)\n        return fallback;\n    try {\n        const result = await moose.client.query.execute(query);\n        return result.json() as T;\n    }\n    catch (e) {\n        console.warn('Query failed, using fallback:', e);\n        return fallback;\n    }\n}\n// Overview Tab Queries\nexport const getOverviewMetrics = async () => {\n    const revenue = await executeQuery<{\n        total_revenue: number;\n    }[]>(sql `SELECT sum(amount) as total_revenue FROM ${Events} WHERE event_type = 'purchase'`, MOCK_REVENUE);\n    const sales = await executeQuery<{\n        total_sales: number;\n    }[]>(sql `SELECT count(*) as total_sales FROM ${Events} WHERE event_type = 'purchase'`, MOCK_SALES);\n    const activeUsers = await executeQuery<{\n        active_users: number;\n    }[]>(sql `SELECT uniq(customer_id) as active_users FROM ${Events} WHERE event_time > now() - interval 1 hour`, MOCK_ACTIVE);\n    return {\n        totalRevenue: revenue[0]?.total_revenue || 0,\n        totalSales: sales[0]?.total_sales || 0,\n        activeNow: activeUsers[0]?.active_users || 0\n    };\n};\nexport const getRevenueOverTime = async () => {\n    return await executeQuery<{\n        month: string;\n        revenue: number;\n    }[]>(sql `\n      SELECT \n        toStartOfMonth(event_time) as month, \n        sum(amount) as revenue \n      FROM ${Events} \n      WHERE event_type = 'purchase' \n      GROUP BY month \n      ORDER BY month ASC\n    `, MOCK_REVENUE_OVER_TIME);\n};\nexport const getRecentSales = async () => {\n    return await executeQuery<EventModel[]>(sql `\n      SELECT * \n      FROM ${Events} \n      WHERE event_type = 'purchase' \n      ORDER BY event_time DESC \n      LIMIT 5\n    `, MOCK_RECENT_SALES);\n};\n// Products Tab Queries\nexport const getTopProducts = async () => {\n    return await executeQuery<{\n        product_name: string;\n        total_sales: number;\n        total_revenue: number;\n        status: string;\n    }[]>(sql `\n      SELECT \n        product_name,\n        count(*) as total_sales,\n        sum(amount) as total_revenue,\n        any(status) as status\n      FROM ${Events}\n      WHERE event_type = 'purchase'\n      GROUP BY product_name\n      ORDER BY total_revenue DESC\n      LIMIT 10\n    `, MOCK_TOP_PRODUCTS);\n};\n// Customers Tab Queries\nexport const getCustomerStats = async () => {\n    const total = await executeQuery<{\n        total_customers: number;\n    }[]>(sql `SELECT uniq(customer_id) as total_customers FROM ${Events}`, MOCK_CUSTOMER_STATS_TOTAL);\n    const recentCustomers = await executeQuery<{\n        customer_name: string;\n        customer_email: string;\n        spent: number;\n        status: string;\n    }[]>(sql `\n      SELECT \n        customer_name, \n        customer_email, \n        sum(amount) as spent,\n        'Active' as status\n      FROM ${Events}\n      WHERE event_type = 'purchase'\n      GROUP BY customer_name, customer_email\n      ORDER BY spent DESC\n      LIMIT 10\n    `, MOCK_RECENT_CUSTOMERS);\n    return {\n        totalCustomers: total[0]?.total_customers || 0,\n        recentCustomers\n    };\n};\n"]}